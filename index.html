<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>A'</title>

<style>
:root{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#fff;
  --accent:#3b82f6;
}
[data-theme="light"]{
  --bg:#f8fafc;
  --card:#e5e7eb;
  --text:#020617;
}
*{box-sizing:border-box;font-family:system-ui}
body{
  margin:0;background:var(--bg);color:var(--text);
  display:flex;justify-content:center;align-items:center;
  min-height:100svh;
}
button,input{
  padding:12px;border-radius:8px;border:none;font-size:16px;
}
button{background:var(--accent);color:white}
button:disabled{opacity:.5}
.container{
  width:100%;max-width:420px;padding:20px;
}
.hidden{display:none}
.center{text-align:center}

/* INTRO */
#intro{
  position:fixed;inset:0;display:flex;
  align-items:center;justify-content:center;
  font-size:96px;font-weight:900;
  animation:intro 1.4s ease forwards;
  background:var(--bg);z-index:10;
}
@keyframes intro{
  0%{transform:scale(3);opacity:0}
  60%{opacity:1}
  100%{transform:scale(1);opacity:0}
}

/* TIMER */
.timer{
  height:6px;background:#334155;border-radius:99px;
  overflow:hidden;margin:10px 0;
}
.timer > div{
  height:100%;background:#22c55e;
  transition:width .2s linear;
}

/* OPTIONS */
.option{
  width:100%;margin-top:10px;
  background:#334155;color:white;
}

/* EMOJI */
.reactions span{
  font-size:24px;cursor:pointer;margin:0 4px;
}
</style>
</head>

<body>

<div id="intro">A'</div>

<div class="container hidden" id="app">

<!-- MENU -->
<div id="menu" class="center">
  <h1>A'</h1>
  <button onclick="createRoom()">Create Room</button>
  <input id="joinInput" placeholder="Room Code">
  <button onclick="joinRoom()">Join</button>
  <br><br>
  <button onclick="toggleTheme()">ðŸŒ“ Theme</button>
  <button onclick="toggleAudio()">ðŸ”Š Audio</button>
</div>

<!-- LOBBY -->
<div id="lobby" class="hidden center">
  <h3>Room <span id="roomCode"></span></h3>
  <p>Waiting for playersâ€¦</p>
</div>

<!-- GAME -->
<div id="game" class="hidden">
  <div id="score"></div>
  <div class="timer"><div id="bar"></div></div>
  <h3 id="q"></h3>
  <div id="opts"></div>
  <div class="reactions center">
    <span onclick="react('ðŸ”¥')">ðŸ”¥</span>
    <span onclick="react('ðŸ˜‚')">ðŸ˜‚</span>
    <span onclick="react('ðŸ˜®')">ðŸ˜®</span>
  </div>
</div>

<!-- SPECTATOR -->
<div id="spectator" class="hidden center">
  <h3>Spectating</h3>
  <div id="specView"></div>
</div>

</div>

<script>
/* ---------- STATE ---------- */
const bc = new BroadcastChannel("A_GAME");
let role="player",room=null,audio=true,offlineQ=[];
const Qs=[
 {c:"General",q:"Capital of France?",o:["Paris","Rome","Berlin","Madrid"],a:0},
 {c:"Math",q:"7Ã—6?",o:["42","36","40","48"],a:0},
 {c:"Space",q:"Red planet?",o:["Mars","Venus","Jupiter","Saturn"],a:0}
];

/* ---------- INTRO ---------- */
setTimeout(()=>{
  intro.remove();
  app.classList.remove("hidden");
},1400);

/* ---------- ROOM ---------- */
function code(){return Math.random().toString(36).slice(2,8).toUpperCase()}
function createRoom(){
 room=code();
 localStorage.setItem(room,JSON.stringify({
  i:0,t:10,players:{},started:false
 }));
 location.search="?room="+room;
}
function joinRoom(){
 room=joinInput.value.trim().toUpperCase();
 location.search="?room="+room;
}
const p=new URLSearchParams(location.search);
if(p.get("room")){
 room=p.get("room");
 if(p.get("view")==="watch"){role="spectator";spectator.classList.remove("hidden")}
 else lobby.classList.remove("hidden");
}

/* ---------- GAME LOOP ---------- */
bc.onmessage=e=>{
 if(e.data.room!==room) return;
 render(e.data.state);
}
function start(){
 const s=JSON.parse(localStorage.getItem(room));
 s.started=true;
 localStorage.setItem(room,JSON.stringify(s));
 tick();
}
function tick(){
 let s=JSON.parse(localStorage.getItem(room));
 if(!s||!s.started) return;
 s.t--;
 if(s.t<=0){s.i++;s.t=10}
 localStorage.setItem(room,JSON.stringify(s));
 bc.postMessage({room,state:s});
 if(s.i<Qs.length) setTimeout(tick,1000);
}

/* ---------- RENDER ---------- */
function render(s){
 if(role==="spectator"){
   specView.innerText=Qs[s.i]?.q||"Game Over";
   return;
 }
 lobby.classList.add("hidden");
 game.classList.remove("hidden");
 q.innerText=Qs[s.i]?.q||"Game Over";
 bar.style.width=(s.t/10*100)+"%";
 opts.innerHTML="";
 if(!Qs[s.i]) return;
 let shuffled=[...Qs[s.i].o].sort(()=>Math.random()-.5);
 shuffled.forEach((o,i)=>{
  let b=document.createElement("button");
  b.className="option";b.innerText=o;
  b.disabled=true;
  setTimeout(()=>b.disabled=false,400);
  b.onclick=()=>answer(o);
  opts.appendChild(b);
 });
}

/* ---------- ANSWER ---------- */
function answer(val){
 let s=JSON.parse(localStorage.getItem(room));
 let q=Qs[s.i];
 if(val===q.o[q.a]) beep(600);
 else beep(200);
}

/* ---------- EXTRAS ---------- */
function react(e){bc.postMessage({room,react:e})}
function toggleTheme(){
 document.documentElement.dataset.theme=
 document.documentElement.dataset.theme==="dark"?"light":"dark";
}
function toggleAudio(){audio=!audio}
function beep(f){
 if(!audio) return;
 const a=new AudioContext();
 const o=a.createOscillator();
 o.frequency.value=f;o.connect(a.destination);
 o.start();setTimeout(()=>o.stop(),80);
}

/* ---------- OFFLINE ---------- */
window.addEventListener("offline",()=>offlineQ.push(Date.now()));
window.addEventListener("online",()=>offlineQ=[]);
</script>

</body>
</html>
